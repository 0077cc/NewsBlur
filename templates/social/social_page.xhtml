{% load utils_tags social_tags %}

<!DOCTYPE html>
<html>

<head>
    <title>Circular</title><!--{{ social_profile.title }}-->
    <link rel="alternate" type="application/rss+xml" href="{% url shared-stories-rss-feed social_profile.user_id social_profile.username|slugify %}" title="{{ social_profile.feed_title }} RSS feed">
    <link rel="shortcut icon" href="{{ social_profile.photo_url }}">
    <link rel="icon" href="{{ social_profile.photo_url }}">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1.5">
    <link rel="apple-touch-icon" href="{{ MEDIA_URL }}img/circular/circular_apple_icon.png"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />  
    
    {% include_stylesheets "blurblog" %}
    
    {% if social_profile.custom_css %}
    <style type="text/css" media="screen">
        {{ social_profile.custom_css|safe }}
    </style>
    {% endif %}

    <script type="text/javascript" charset="utf-8">
    window.NEWSBLUR = {};
    NEWSBLUR.Globals = {
        'is_authenticated' : {{ user.is_authenticated|yesno:"true,false" }},
        'is_anonymous'     : {{ user.is_anonymous|yesno:"true,false" }},
        'is_premium'       : {{ user.profile.is_premium|yesno:"true,false" }},
        'is_admin'         : {{ user.is_staff|yesno:"true,false" }},
        'is_staff'         : {{ user.is_staff|yesno:"true,false" }},
        'secret_token'     : "{{ user.profile.secret_token }}",
        'username'         : "{{ user.username|safe }}",
        'user_id'          : "{{ user.pk|safe }}",
        'blurblog_user_id' : "{{ social_profile.user_id|safe }}",
        'email'            : "{{ user.email|safe }}",
        'MEDIA_URL'        : "{{ MEDIA_URL }}",
    };
    NEWSBLUR.user_social_profile = {{ user_social_profile_page|safe }};
    NEWSBLUR.user_social_services = {{ user_social_services_page|safe }};
    NEWSBLUR.Preferences = {};
    NEWSBLUR.Models = {};
    NEWSBLUR.Collections = {};
    NEWSBLUR.Views = {};
    NEWSBLUR.app = {};
    </script>
    
  {% if not debug %}
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8371683-2']);
    _gaq.push(['_setDomainName', "{{ social_profile.username }}.newsblur.com"]);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
  {% endif %}

</head>

<body class="{% if user.is_authenticated %}NB-authenticated{% else %}NB-unauthenticated{% endif %}">
<header class="NC-header">
    <div class="NC-header-inner">
        {% if user.is_authenticated %}
        <ul>
            <li class="NC-user-tab NC-active">
                <div class="NC-tab-inner">
                    <span><img src="{{ social_profile.large_photo_url }}" /></span>
                    {{ social_profile.username }}
                </div>
            </li>
            <li class="NC-trending-tab">
                <div class="NC-tab-inner">
                    <span class="NC-icon"></span>
                    Trending
                </div>
            </li>
            <li class="NC-following-tab">
                <div class="NC-tab-inner">
                    <span class="NC-icon"></span>
                    Following
                </div>
            </li>
            <li class="NC-activity-tab NC-logout-button">
                <div class="NC-tab-inner">
                    Logout
                </div>
            </li>
        </ul>
        {% else %}
            <h1 class="NC-logo"><a href="{% url index %}"><img src="{{ MEDIA_URL }}img/circular/circular_logo.png" width="180" height="45"></a></h1>
                <div class="NC-button NC-login-toggle-button">Sign In</div>

                <div class="NC-button NC-request-toggle-button">Request an Invite</div>

                <div class="NC-login-popover NC-popover">
                    <div class="NC-popover-inner">
                        <input type="text" placeholder="Username or email" name="login_username" class="NC-input" />
                        <input placeholder="Password" type="password" name="login_password" class="NC-input" />
                        <div class="NC-login-button NC-blue-button">Login</div>
                    </div>
                    <div class="NC-popover-bottom"></div>
                </div>
                <div class="NC-request-popover NC-popover">
                    <div class="NC-popover-inner">
                        <input type="text" placeholder="Email Address" name="request_email" class="NC-input" />
                        <div class="NC-request-button NC-blue-button">Request</div>
                    </div>
                    <div class="NC-popover-bottom"></div>
                </div>
            </div>
        {% endif %}
    </div>
</header>

<div class="NB-page">
    <div class="NC-watermark">
        <div class="NC-watermark-logo">
            <a href="//{% current_domain %}"><img src="{{ MEDIA_URL }}img/circular/circular_footer.png" />
        </div>
    </div>
    {% for story in stories %}
        {% render_social_story story %}
    {% endfor %}

    {% if has_next_page %}
        <div class="NB-page-controls">
            <div class="NB-page-controls-next">
                <div class="NB-page-controls-text NB-page-controls-text-next">
                    Next Page of Stories
                </div>
                <div class="NB-page-controls-text NB-page-controls-text-loading"></div>
                <div class="NB-page-controls-text NB-page-controls-text-loaded">
                </div>
            </div>
        </div>
    {% endif %}
    
</div>
    
{% include_javascripts "blurblog" %}

<script type="text/javascript" charset="utf-8">
    _.extend(NEWSBLUR.Preferences, {% if user_profile.preferences %}{{ user_profile.preferences|safe }}{% else %}{}{% endif %});
</script>

<script>
// if ($(window).width() < 600) { 
//     $('meta[name=viewport]').attr('content','initial-scale=0.9, maximum-scale=1.5'); 
// }
</script>

</body>

</html>