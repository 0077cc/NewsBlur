{% load utils_tags social_tags %}

<!DOCTYPE html>
<html>

<head>
    <title>{{ social_profile.feed_title }}</title>
    <link rel="alternate" type="application/rss+xml" href="{% url shared-stories-rss-feed social_profile.user_id social_profile.username|slugify %}" title="{{ social_profile.feed_title }} RSS feed">
    <link rel="shortcut icon" HREF="{{ social_profile.photo_url }}">
    <meta name="viewport" content="width=440px">
    
    {% include_stylesheets "blurblog" %}
    
    {% if social_profile.custom_css %}
    <style type="text/css" media="screen">
        {{ social_profile.custom_css|safe }}
    </style>
    {% endif %}

    <script type="text/javascript" charset="utf-8">
    window.NEWSBLUR = {};
    NEWSBLUR.Globals = {
        'is_authenticated' : {{ user.is_authenticated|yesno:"true,false" }},
        'is_anonymous'     : {{ user.is_anonymous|yesno:"true,false" }},
        'is_premium'       : {{ user.profile.is_premium|yesno:"true,false" }},
        'is_admin'         : {{ user.is_staff|yesno:"true,false" }},
        'is_staff'         : {{ user.is_staff|yesno:"true,false" }},
        'secret_token'     : "{{ user.profile.secret_token }}",
        'username'         : "{{ user.username|safe }}",
        'user_id'          : "{{ user.pk|safe }}",
        'blurblog_user_id' : "{{ social_profile.user_id|safe }}",
        'email'            : "{{ user.email|safe }}",
        'MEDIA_URL'        : "{{ MEDIA_URL }}",
    };
    NEWSBLUR.Models = {};
    NEWSBLUR.Collections = {};
    NEWSBLUR.Views = {};
    NEWSBLUR.app = {};
    </script>

</head>

<body>
    
<div class="NB-page">
    <header class="NB-header">
        <h1 class="NB-title {% if not social_profile.bio %}NB-title-no-bio{% endif %}">
            <a href="http://{% current_domain %}/social/{{ social_profile.user_id }}/{{ social_profile.username|slugify }}" class="NB-title-logo">
                <img src="{{ MEDIA_URL }}img/logo_128.png" class="NB-hover-off" />
                <img src="{{ MEDIA_URL }}img/logo_newsblur_512.png" class="NB-hover-on" />
            </a>
            <div class="NB-title-background"></div>
            <div class="NB-title-left">
                <div class="NB-title-photo">
                    {% if social_profile.photo_url %}
                        <img src="{{ social_profile.photo_url }}" />
                    {% else %}
                        <img src="{{ MEDIA_URL }}img/reader/default_profile_photo.png" />
                    {% endif %}
                </div>
                <div class="NB-title-content">
                    <div class="NB-title-name">
                        {{ social_profile.feed_title }}
                    </div>
                    {% if social_profile.location %}
                        <div class="NB-title-location">
                            {{ social_profile.location }}
                        </div>
                    {% endif %}
                    {% if social_profile.bio %}
                        <div class="NB-title-bio">
                            {{ social_profile.bio }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </h1>
        <div class="NB-header-feed">
            {# <a type="application/rss+xml" href="{% url shared-stories-rss-feed social_profile.user_id social_profile.username|slugify %}">RSS feed for this page</a> #}
        </div>
    </header>

    {% for story in stories %}
        <div class="NB-mark">
            <div class="NB-divider"></div>
            <div class="NB-feed NB-feed-{{ story.feed.favicon_text_color }}" style="
                background-image: -webkit-gradient( linear, left bottom, left top, color-stop(0.16, #{{ story.feed.favicon_color }}), color-stop(0.84, #{{ story.feed.favicon_fade }}) );
                background-image: -moz-linear-gradient( center bottom, #{{ story.feed.favicon_color }} 16%, #{{ story.feed.favicon_fade }} 84% );
                border: 1px solid #{{ story.feed.favicon_border }};
                ">
                {% if story.feed %}
                    <div class="NB-feed-favicon">
                        <img src="{{ story.feed.favicon_url }}" />
                    </div>
                    <div class="NB-feed-title">
                        <a href="/site/{{ story.feed.id }}/">{{ story.feed.feed_title }}</a>
                    </div>
                {% endif %}
            </div>
            
            <div class="NB-story-header-wrapper">
                <div class="NB-story-header">
                    {% if story.story_authors %}
                        <div class="NB-story-author">{{ story.story_authors }}</div>
                    {% endif %}
                    {% if story.story_tags %}
                        <div class="NB-story-tags">
                            {% for story_tag in story.story_tags %}
                                <div class="NB-story-tag">{{ story_tag }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <div class="NB-story-title">
                        <a href="{{ story.story_permalink }}">{{ story.story_title }}</a>
                    </div>
                    <div class="NB-story-date">
                        {% if story.has_modifications %}
                            <div class="NB-story-modifications-button" title="Show story changes"></div>
                        {% endif %}

                        {{ story.shared_date|date:"l, F j<\s\u\p>S</\s\u\p>, Y <\s\m\a\l\l>\a\t</\s\m\a\l\l> g:i A"|safe }} 
                    </div>
                </div>
            </div>
            
            <div class="NB-story" data-feed-id="{{ story.story_feed_id }}" data-story-id="{{ story.id }}">
                <div class="NB-story-content">{{ story.story_content|safe }}</div>
            
                {% if story.share_count %}
                    {% render_story_share story %}
                {% endif %}
            </div>
        </div>
    {% endfor %}

</div>
    
{% include_javascripts "blurblog" %}

</body>

</html>